<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shivam Gift House</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#fff5f5;
  --card:#fff;
  --text:#000;
}

.dark{
  --bg:#111;
  --card:#1c1c1c;
  --text:#fff;
}

body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
}

header{
  background:#ff4d6d;
  color:white;
  text-align:center;
  padding:15px;
  font-size:26px;
}

.banner{
  background:gold;
  text-align:center;
  padding:10px;
  font-weight:bold;
  animation:blink 1s infinite alternate;
}

@keyframes blink{
  from{opacity:1;}
  to{opacity:0.6;}
}

.controls{
  text-align:center;
  padding:10px;
}

input,select,button{
  padding:8px;
  margin:5px;
}

.products{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
  padding:15px;
}

.card{
  background:var(--card);
  border-radius:10px;
  padding:10px;
  box-shadow:0 2px 5px rgba(0,0,0,0.3);
  text-align:center;
}

.card img{
  width:200px;
  height:200px;
  object-fit:cover;
  border-radius:8px;
  margin:0 auto;
  display:block;
}

.footer{
  background:#333;
  color:white;
  text-align:center;
  padding:20px;
}

.admin{
  display:none;
  background:#000;
  color:white;
  padding:15px;
}

.themeBtn{
  position:fixed;
  top:10px;
  right:10px;
}
</style>
</head>

<body>

<header>üéÅ Shivam Gift House</header>
<button class="themeBtn" onclick="toggleTheme()">üåô</button>

<div class="banner" id="banner">Festival Offer!</div>

<div class="controls">
  <input id="search" placeholder="Search products...">
  <select id="catFilter">
    <option value="">All Categories</option>
    <option>Gift</option>
    <option>Decoration</option>
    <option>Festival</option>
  </select>
</div>

<div class="products" id="products"></div>

<div class="footer">
  <h3>About</h3>
  <p id="about">Best gift and decoration shop in town.</p>
  <h3>Contact</h3>
  <p id="phone">+91-XXXXXXXXXX</p>
  <p id="location">Your Shop Address</p>
</div>

<!-- ADMIN PANEL -->
<div class="admin" id="adminPanel">
  <h2>Admin Panel</h2>
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>

  <div id="adminArea" style="display:none;">
    <h3>Add Product</h3>
    <input id="aname" placeholder="Product Name">
    <input id="aprice" placeholder="Price">
    <input id="aimg" placeholder="Image link">
    <input id="adesc" placeholder="Description">
    <input id="acat" placeholder="Category">
    <button onclick="addProduct()">Add Product</button>
    <button onclick="refreshProducts()">Refresh Products</button>
  </div>
</div>

<script>
const PRODUCT_API="https://script.google.com/macros/s/AKfycbypjTfCgXFVyqlZh3xSkOt4WsyYuoWwcwpLKUpku1a3NWlGsTIK-4pFCk9Nz_Q6FhwM/exec";
const SETTINGS_API="https://script.google.com/macros/s/AKfycbypjTfCgXFVyqlZh3xSkOt4WsyYuoWwcwpLKUpku1a3NWlGsTIK-4pFCk9Nz_Q6FhwM/exec";

const ADMIN_USER="admin";
const ADMIN_PASS="1234";

let products=[];
let settings={};

const productsDiv=document.getElementById("products");
const banner=document.getElementById("banner");
const about=document.getElementById("about");
const phone=document.getElementById("phone");
const locationEl=document.getElementById("location");

// Load products from sheet
function loadProducts(){
  fetch(PRODUCT_API+"?sheet=products")
    .then(r=>r.json())
    .then(d=>{
      products=d;
      show(products);
    });
}

// Load settings from sheet
function loadSettings(){
  fetch(SETTINGS_API+"?sheet=settings")
    .then(r=>r.json())
    .then(s=>{
      settings=s[0] || {banner:"Festival Offer!", about:"Best gift shop", phone:"", location:"", online:"no"};
      banner.innerText=settings.banner;
      about.innerText=settings.about;
      phone.innerText=settings.phone;
      locationEl.innerText=settings.location;
    });
}

// Display products
function show(list){
  productsDiv.innerHTML="";
  list.forEach(p=>{
    let orderBtn = (settings.online=="yes") 
      ? `<a href="https://wa.me/${settings.phone}?text=I want ${p.name}" target="_blank">
         <button>Order</button></a>` 
      : "";
    productsDiv.innerHTML+=`
      <div class="card">
        <img src="${p.image}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p>${p.description}</p>
        <b>‚Çπ${p.price}</b><br>${orderBtn}
      </div>
    `;
  });
}

// Search & category filter
document.getElementById("search").oninput=filter;
document.getElementById("catFilter").onchange=filter;
function filter(){
  let t=document.getElementById("search").value.toLowerCase();
  let c=document.getElementById("catFilter").value;
  let f=products.filter(p=>
    p.name.toLowerCase().includes(t) &&
    (c==""||p.category==c)
  );
  show(f);
}

// Dark theme toggle
function toggleTheme(){
  document.body.classList.toggle("dark");
}

// Admin panel
if(location.hash=="#admin") document.getElementById("adminPanel").style.display="block";

function login(){
  const u=document.getElementById("user").value;
  const p=document.getElementById("pass").value;
  if(u===ADMIN_USER && p===ADMIN_PASS){
    document.getElementById("adminArea").style.display="block";
    alert("Login success");
  }else{
    alert("Wrong username or password");
  }
}

// Add product
function addProduct(){
  const newProduct = {
    name: document.getElementById("aname").value,
    price: document.getElementById("aprice").value,
    image: document.getElementById("aimg").value,
    description: document.getElementById("adesc").value,
    category: document.getElementById("acat").value
  };

  fetch(PRODUCT_API+"?sheet=products", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(newProduct)
  })
  .then(res => res.json())
  .then(data => {
    if(data.status==="success"){
      alert("Product added successfully!");
      // Clear input fields
      document.getElementById("aname").value="";
      document.getElementById("aprice").value="";
      document.getElementById("aimg").value="";
      document.getElementById("adesc").value="";
      document.getElementById("acat").value="";
      loadProducts();
    } else {
      alert("Error: "+data.message);
    }
  })
  .catch(err => alert("Network error: "+err));
}

// Refresh products
function refreshProducts(){
  loadProducts();
}

// Initial load
loadSettings();
loadProducts();

// PWA support
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
