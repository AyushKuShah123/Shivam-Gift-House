<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shivam Gift House</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#fff5f5;
  --card:#fff;
  --text:#000;
}

.dark{
  --bg:#111;
  --card:#1c1c1c;
  --text:#fff;
}

body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
}

header{
  background:#ff4d6d;
  color:white;
  text-align:center;
  padding:15px;
  font-size:26px;
}

.banner{
  background:gold;
  text-align:center;
  padding:10px;
  font-weight:bold;
  animation:blink 1s infinite alternate;
}

@keyframes blink{
  from{opacity:1;}
  to{opacity:0.6;}
}

.controls{
  text-align:center;
  padding:10px;
}

input,select,button{
  padding:8px;
  margin:5px;
}

.products{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
  padding:15px;
}

.card{
  background:var(--card);
  border-radius:10px;
  padding:10px;
  box-shadow:0 2px 5px rgba(0,0,0,0.3);
  text-align:center;
}

.card img{
  width:200px;
  height:200px;
  object-fit:cover;
  border-radius:8px;
  margin:0 auto;
  display:block;
}

.footer{
  background:#333;
  color:white;
  text-align:center;
  padding:20px;
}

.admin{
  display:none;
  background:#000;
  color:white;
  padding:15px;
}

.themeBtn{
  position:fixed;
  top:10px;
  right:10px;
}
</style>
</head>

<body>

<header>üéÅ Shivam Gift House</header>
<button class="themeBtn" onclick="toggleTheme()">üåô</button>

<div class="banner" id="banner">Festival Offer!</div>

<div class="controls">
  <input id="search" placeholder="Search products...">
  <select id="catFilter">
    <option value="">All Categories</option>
    <option>Gift</option>
    <option>Decoration</option>
    <option>Festival</option>
  </select>
</div>

<div class="products" id="products"></div>

<div class="footer">
  <h3>About</h3>
  <p id="about">Best gift and decoration shop in town.</p>
  <h3>Contact</h3>
  <p id="phone1">+977-9847256046</p>
  <p id="phone2">+977-9867380880</p>
  <p id="location">
  <a href="https://www.google.com/maps/@27.5547496,83.7906477,20.39z?entry=ttu"
     target="_blank"
     style="color:white;text-decoration:underline;">
     üìç Bardaghat-4, NawalParasi West (View Map)
  </a>
</p>

</div>

<!-- ADMIN PANEL -->
<div class="admin" id="adminPanel">
  <h2>Admin Panel</h2>

  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>

  <div id="adminArea" style="display:none;">
    <h3>Add Product</h3>
    <input id="aname" placeholder="Product Name">
    <input id="aprice" placeholder="Price">
    <input id="aimg" placeholder="Image link">
    <input id="adesc" placeholder="Description">
    <input id="acat" placeholder="Category">
    <button onclick="addProduct()">Add Product</button>
    <button onclick="refreshProducts()">Refresh</button>
  </div>
</div>

<script>
const PRODUCT_API="https://script.google.com/macros/s/AKfycbypjTfCgXFVyqlZh3xSkOt4WsyYuoWwcwpLKUpku1a3NWlGsTIK-4pFCk9Nz_Q6FhwM/exec";
const SETTINGS_API=PRODUCT_API;

const ADMIN_USER="admin";
const ADMIN_PASS="1234";

let products=[];
let settings={};

const productsDiv=document.getElementById("products");
const banner=document.getElementById("banner");
const about=document.getElementById("about");
const phone=document.getElementById("phone");
const locationEl=document.getElementById("location");

function loadProducts(){
  fetch(PRODUCT_API+"?sheet=products")
    .then(r=>r.json())
    .then(d=>{
      products=d;
      show(products);
    });
}

function loadSettings(){
  fetch(SETTINGS_API+"?sheet=settings")
    .then(r=>r.json())
    .then(s=>{
      settings=s[0] || {};
      banner.innerText=settings.banner || "Festival Offer!";
      about.innerText=settings.about || "";
      phone.innerText=settings.phone || "";
      locationEl.innerText=settings.location || "";
    });
}

function show(list){
  productsDiv.innerHTML="";
  list.forEach(p=>{
    let orderBtn = (settings.online=="yes") 
      ? `<a href="https://wa.me/${settings.phone}?text=I want ${p.name}" target="_blank">
         <button>Order</button></a>` 
      : "";

    productsDiv.innerHTML+=`
      <div class="card">
        <img src="${p.image}">
        <h3>${p.name}</h3>
        <p>${p.description}</p>
        <b>‚Çπ${p.price}</b><br>${orderBtn}
      </div>
    `;
  });
}

document.getElementById("search").oninput=filter;
document.getElementById("catFilter").onchange=filter;

function filter(){
  let t=document.getElementById("search").value.toLowerCase();
  let c=document.getElementById("catFilter").value;

  let f=products.filter(p=>
    (p.name||"").toLowerCase().includes(t) &&
    (c==""||p.category==c)
  );

  show(f);
}

function toggleTheme(){
  document.body.classList.toggle("dark");
}

/* ‚úÖ ADMIN PANEL FIX */
function checkAdmin(){
  const panel=document.getElementById("adminPanel");
  if(window.location.hash==="#admin"){
    panel.style.display="block";
  }else{
    panel.style.display="none";
  }
}
checkAdmin();
window.addEventListener("hashchange",checkAdmin);

function login(){
  const u=document.getElementById("user").value;
  const p=document.getElementById("pass").value;

  if(u===ADMIN_USER && p===ADMIN_PASS){
    document.getElementById("adminArea").style.display="block";
    alert("Login success");
  }else{
    alert("Wrong login");
  }
}

function addProduct(){
  const newProduct={
    name:aname.value,
    price:aprice.value,
    image:aimg.value,
    description:adesc.value,
    category:acat.value
  };

  fetch(PRODUCT_API+"?sheet=products",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(newProduct)
  })
  .then(r=>r.json())
  .then(()=>{
    alert("Product added!");
    aname.value="";
    aprice.value="";
    aimg.value="";
    adesc.value="";
    acat.value="";
    loadProducts();
  })
  .catch(err=>alert("Network error"));
}

function refreshProducts(){
  loadProducts();
}

loadSettings();
loadProducts();

if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
